% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/scoutfdr.R
\name{adaptive_fdr}
\alias{adaptive_fdr}
\title{Adaptive FDR control (Safe-U + optional Conformal)}
\usage{
adaptive_fdr(
  pvals,
  alpha = 0.1,
  K = 2,
  delta_ecdf = 0.02,
  H = c(0.1, 0.2, 0.3),
  use_conformal = FALSE,
  cqr_fit = NULL,
  cal_df = NULL,
  feature_names = NULL,
  feature_fun = function(pp) as.list(features_ecdf(pp)),
  ood_params = list(alpha_cqr = 0.05, max_weight = 4),
  mode = c("both", "safe", "conformal")
)
}
\arguments{
\item{pvals}{Numeric p-values.}

\item{alpha}{Target FDR level.}

\item{K}{Number of folds (default 2).}

\item{delta_ecdf}{Total miscoverage for Safe-U component.}

\item{H}{Tail thresholds (default: c(0.1, 0.2, 0.3)).}

\item{use_conformal}{Logical: whether to use CQR-based conformal bound.}

\item{cqr_fit}{Optional CQR model (from \code{train_cqr_pi0()}).}

\item{cal_df}{Calibration dataset used for CQR.}

\item{feature_names}{Feature columns used in CQR.}

\item{feature_fun}{Function producing feature vectors (default ECDF).}

\item{ood_params}{List with:
\itemize{
\item alpha_cqr: miscoverage level for conformal bound
\item max_weight: weight clipping for density ratio
}}

\item{mode}{One of "safe", "conformal", "both".}
}
\value{
A list with:
\itemize{
\item rejections: vector of rejected indices
\item U_fold: per-fold \eqn{\pi_0} upper bounds
\item safe_U: Safe-U bounds only
\item conf_U: conformal bounds only
\item fold_id: fold assignments
}
}
\description{
This implements the SCOUT-FDR procedure:

\strong{Safe-U component:}
\itemize{
\item Computes an upper bound \eqn{U_k} on \eqn{\pi_0} using the one-sided
DKW inequality on ECDF tail masses.
}

\strong{Optional conformal component:}
\itemize{
\item Cross-fitted quantile regression gives an additional, conditional
upper bound on \eqn{\pi_0}, producing a sharper \eqn{U_k}.
}

Final bound:
\itemize{
\item If \code{mode="both"} (default): \eqn{U_k = \min(U_k^{safe}, U_k^{conf})}
}
}
